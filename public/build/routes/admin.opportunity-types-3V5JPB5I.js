import{a as f,b as v,c as b,d as C,e as N,f as z,g as D,h as p}from"/build/_shared/chunk-VW3PRCRT.js";import{c as n}from"/build/_shared/chunk-EZLK7DRW.js";import{a as O}from"/build/_shared/chunk-4AULA3DX.js";import"/build/_shared/chunk-AMZSOOKO.js";import"/build/_shared/chunk-DPBD6AQE.js";import{l as P,m as k,q as I}from"/build/_shared/chunk-LU4WXESO.js";import{h as x}from"/build/_shared/chunk-UIQJLUVK.js";import{a as V,b as E}from"/build/_shared/chunk-F33EF4G7.js";import{d as h}from"/build/_shared/chunk-2QEWK57A.js";var r=h(V(),1);var e=h(E(),1);function L(){let[B,F]=(0,r.useState)([]),[j,H]=(0,r.useState)([]),[A,T]=(0,r.useState)(!0),[a,i]=(0,r.useState)(null),[u,s]=(0,r.useState)(null),[w,$]=(0,r.useState)(""),[l,R]=x(),[m,U]=(0,r.useState)(Number(l.get("page"))||1),[g,G]=(0,r.useState)(Number(l.get("pageSize"))||10),y=async()=>{T(!0);try{let o=await(await fetch("http://localhost:5055/api/v1/opportunity-type",{credentials:"include"})).json();F(o)}catch(t){console.error("Error al cargar tipos de oportunidad",t)}finally{T(!1)}},J=async()=>{try{let o=await(await fetch("http://localhost:5055/api/v1/categories",{credentials:"include"})).json();H(o)}catch(t){console.error("Error al cargar categor\xEDas",t)}},M=async()=>{if(!a)return;let t=a.id?"PUT":"POST",o=a.id?`http://localhost:5055/api/v1/opportunity-type/${a.id}`:"http://localhost:5055/api/v1/opportunity-type",c=JSON.stringify({name:a.name,description:a.description,categoryId:a.categoryId,opportunityType:a.name});try{let d=await fetch(o,{method:t,headers:{"Content-Type":"application/json"},credentials:"include",body:c});if(d.ok)y(),i(null);else{let Q=await d.json();console.error("Error al guardar tipo de oportunidad",Q)}}catch(d){console.error("Error en la petici\xF3n",d)}},q=async()=>{if(u)try{await fetch(`http://localhost:5055/api/v1/opportunity-type/${u}`,{method:"DELETE",credentials:"include"}),s(null),y()}catch(t){console.error("Error al eliminar tipo de oportunidad",t)}};(0,r.useEffect)(()=>{y(),J()},[]);let S=B.filter(t=>t.name.toLowerCase().includes(w.toLowerCase())),K=S.slice((m-1)*g,m*g);return(0,r.useEffect)(()=>{let t=Number(l.get("pageSize"))||10;G(t)},[l]),(0,e.jsxs)("div",{children:[A?(0,e.jsx)("p",{className:"text-4xl",children:"Cargando tipos de oportunidad..."}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)(n,{onClick:()=>i({name:"",description:"",categoryId:0,opportunityType:""}),className:"flex gap-2 items-center",children:[(0,e.jsx)(k,{size:18})," Nuevo"]}),(0,e.jsx)(f,{placeholder:"Buscar por nombre...",value:w,onChange:t=>$(t.target.value),className:"w-1/2"})]}),(0,e.jsx)("div",{className:"overflow-auto",children:(0,e.jsxs)("table",{className:"min-w-full bg-white rounded shadow dark:bg-neutral-600",children:[(0,e.jsx)("thead",{className:"bg-gray-100",children:(0,e.jsxs)("tr",{className:"dark:text-black",children:[(0,e.jsx)("th",{className:"p-2 text-left",children:"Nombre"}),(0,e.jsx)("th",{className:"p-2 text-left",children:"Descripci\xF3n"}),(0,e.jsx)("th",{className:"p-2 text-left",children:"Acciones"})]})}),(0,e.jsx)("tbody",{children:K.map(t=>(0,e.jsxs)("tr",{className:"border-t",children:[(0,e.jsx)("td",{className:"p-2 text-left",children:t.name}),(0,e.jsx)("td",{className:"p-2 text-left",children:t.description?t.description.length>60?`${t.description.slice(0,60)}...`:t.description:"Sin descripci\xF3n"}),(0,e.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,e.jsx)(n,{variant:"outline",size:"sm",onClick:()=>i({...t,opportunityType:t.name}),children:(0,e.jsx)(P,{size:16})}),(0,e.jsx)(n,{variant:"destructive",size:"sm",onClick:()=>s(t.id),children:(0,e.jsx)(I,{size:16})})]})]},t.id))})]})})]}),(0,e.jsx)(O,{currentPage:m,totalItems:S.length,pageSize:g,onPageChange:t=>{U(t),R(o=>{let c=new URLSearchParams(o);return c.set("page",String(t)),c})}}),(0,e.jsx)(v,{open:!!a,onOpenChange:()=>i(null),children:(0,e.jsxs)(b,{className:"max-w-md",children:[(0,e.jsx)(C,{children:(0,e.jsx)(N,{children:a?.id?"Editar Tipo de Oportunidad":"Nuevo Tipo de Oportunidad"})}),(0,e.jsxs)("form",{className:"space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(p,{htmlFor:"name",children:"Nombre"}),(0,e.jsx)(f,{id:"name",value:a?.name||"",onChange:t=>i(o=>({...o,name:t.target.value,opportunityType:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(p,{htmlFor:"description",children:"Descripci\xF3n"}),(0,e.jsx)("textarea",{className:"w-full border border-gray-300 rounded p-2 bg-white",id:"description",value:a?.description||"",onChange:t=>i(o=>({...o,description:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(p,{htmlFor:"categoryId",children:"Categor\xEDa"}),(0,e.jsxs)("select",{id:"categoryId",value:a?.categoryId||0,onChange:t=>i(o=>({...o,categoryId:Number(t.target.value)})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,e.jsx)("option",{value:0,children:"Seleccionar categor\xEDa"}),j.map(t=>(0,e.jsx)("option",{value:t.id,children:t.name},t.id))]})]})]}),(0,e.jsxs)(D,{children:[(0,e.jsx)(n,{variant:"outline",onClick:()=>i(null),children:"Cancelar"}),(0,e.jsx)(n,{onClick:M,children:"Guardar"})]})]})}),(0,e.jsx)(v,{open:!!u,onOpenChange:()=>s(null),children:(0,e.jsxs)(b,{"aria-describedby":"delete-type-description",children:[(0,e.jsxs)(C,{children:[(0,e.jsx)(N,{children:"\xBFEliminar tipo de oportunidad?"}),(0,e.jsx)(z,{id:"delete-type-description",children:"Esta acci\xF3n es irreversible. \xBFDeseas continuar?"})]}),(0,e.jsxs)(D,{children:[(0,e.jsx)(n,{onClick:()=>s(null),variant:"outline",children:"Cancelar"}),(0,e.jsx)(n,{onClick:q,variant:"destructive",children:"Eliminar"})]})]})})]})}export{L as default};
