import{a as c,b,c as f,d as N,e as D,f as F,g as w,h as r}from"/build/_shared/chunk-UD3XN2TX.js";import{c as s}from"/build/_shared/chunk-MGHLVMKF.js";import{a as z}from"/build/_shared/chunk-4AULA3DX.js";import"/build/_shared/chunk-AMZSOOKO.js";import"/build/_shared/chunk-NKGL3J4W.js";import{l as k,m as P,q as E}from"/build/_shared/chunk-LU4WXESO.js";import{h as L}from"/build/_shared/chunk-UIQJLUVK.js";import{a as et,b as O}from"/build/_shared/chunk-F33EF4G7.js";import{d as v}from"/build/_shared/chunk-2QEWK57A.js";var n=v(et(),1);var t=v(O(),1);function B(){let[q,j]=(0,n.useState)([]),[$,C]=(0,n.useState)(!0),[S,A]=(0,n.useState)(""),[d,H]=L(),[m,U]=(0,n.useState)(Number(d.get("page"))||1),[g,I]=(0,n.useState)(Number(d.get("pageSize"))||10),[i,o]=(0,n.useState)(null),[R,G]=(0,n.useState)([]),[J,M]=(0,n.useState)([]),[K,Q]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=Number(d.get("pageSize"))||10;I(e)},[d]);let h=async()=>{C(!0);try{let a=await(await fetch("http://localhost:5055/api/v1/opportunity",{credentials:"include"})).json();j(a)}catch(e){console.error("Error al cargar oportunidades",e)}finally{C(!1)}},V=async()=>{let e=async a=>{let l=await fetch(a,{credentials:"include"});return l.ok?l.json():[]};G(await e("http://localhost:5055/api/v1/sectors")),M(await e("http://localhost:5055/api/v1/institution")),Q(await e("http://localhost:5055/api/v1/opportunity-type"))},[W,X]=(0,n.useState)([]),Y=async()=>{let l=(await(await fetch("http://localhost:5055/api/v1/localities",{credentials:"include"})).json()).map(p=>({id:p.id,name:`${p.city} - ${p.state}`}));X(l)},[y,u]=(0,n.useState)(null),Z=async()=>{if(y)try{await fetch(`http://localhost:5055/api/v1/opportunity/${y}`,{method:"DELETE",credentials:"include"}),u(null),h()}catch(e){console.error("Error al eliminar oportunidad",e)}},_=async()=>{if(!i)return;let e=i.id?"PUT":"POST",a=i.id?`http://localhost:5055/api/v1/opportunity/${i.id}`:"http://localhost:5055/api/v1/opportunity",l=i.expirationDate?new Date(i.expirationDate).toISOString():"",p=JSON.stringify({...i,expirationDate:l});try{(await fetch(a,{method:e,headers:{"Content-Type":"application/json"},credentials:"include",body:p})).ok?(h(),o(null)):console.error("Error al guardar oportunidad")}catch(T){console.error("Error en la petici\xF3n",T)}};(0,n.useEffect)(()=>{h(),V(),Y()},[]);let x=q.filter(e=>e.title.toLowerCase().includes(S.toLowerCase())),tt=x.slice((m-1)*g,m*g);return(0,n.useEffect)(()=>{let e=Number(d.get("pageSize"))||10;I(e)},[d]),(0,t.jsxs)("div",{children:[$?(0,t.jsx)("p",{className:"text-4xl",children:"Cargando oportunidades..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)(s,{onClick:()=>o({title:"",description:"",modality:"",status:"abierta",expirationDate:"",institutionId:0,localityId:0,localityCity:"",opportunityTypeId:0,sectorId:0,requirements:"",benefits:""}),className:"flex gap-2 items-center",children:[(0,t.jsx)(P,{size:18})," Nueva"]}),(0,t.jsx)(c,{placeholder:"Buscar por t\xEDtulo...",value:S,onChange:e=>A(e.target.value),className:"w-full md:w-1/2"})]}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsxs)("table",{className:"min-w-full bg-white rounded shadow dark:bg-neutral-600",children:[(0,t.jsx)("thead",{className:"bg-gray-100",children:(0,t.jsxs)("tr",{className:"dark:text-black",children:[(0,t.jsx)("th",{className:"p-2 text-left",children:"T\xEDtulo"}),(0,t.jsx)("th",{className:"p-2",children:"Instituci\xF3n"}),(0,t.jsx)("th",{className:"p-2",children:"Tipo"}),(0,t.jsx)("th",{className:"p-2",children:"Localidad"}),(0,t.jsx)("th",{className:"p-2",children:"Estado"}),(0,t.jsx)("th",{className:"p-2",children:"Publicaci\xF3n"}),(0,t.jsx)("th",{className:"p-2",children:"Expiraci\xF3n"}),(0,t.jsx)("th",{className:"p-2",children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:tt.map(e=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"p-2 text-left",children:e.title}),(0,t.jsx)("td",{className:"p-2",children:e.institutionId}),(0,t.jsx)("td",{className:"p-2",children:e.opportunityTypeId}),(0,t.jsx)("td",{className:"p-2",children:e.localityCity}),(0,t.jsx)("td",{className:"p-2",children:e.status}),(0,t.jsx)("td",{className:"p-2",children:e.publicationDate?.split("T")[0]}),(0,t.jsx)("td",{className:"p-2",children:e.expirationDate?.split("T")[0]}),(0,t.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,t.jsx)(s,{variant:"outline",size:"sm",onClick:()=>o(e),children:(0,t.jsx)(k,{size:16})}),(0,t.jsx)(s,{variant:"destructive",size:"sm",onClick:()=>u(e.id),children:(0,t.jsx)(E,{size:16})})]})]},e.id))})]})})]}),(0,t.jsx)(z,{currentPage:m,totalItems:x.length,pageSize:g,onPageChange:e=>{U(e),H(a=>{let l=new URLSearchParams(a);return l.set("page",String(e)),l})}}),(0,t.jsx)(b,{open:!!i,onOpenChange:()=>o(null),children:(0,t.jsxs)(f,{className:"max-h-[90vh] overflow-auto max-w-[40rem]",children:[(0,t.jsx)(N,{children:(0,t.jsx)(D,{children:i?.id?"Editar Oportunidad":"Nueva Oportunidad"})}),(0,t.jsxs)("form",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"title",children:"T\xEDtulo"}),(0,t.jsx)(c,{id:"title",name:"title",value:i?.title||"",onChange:e=>o(a=>({...a,title:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"description",children:"Descripci\xF3n"}),(0,t.jsx)("textarea",{id:"description",name:"description",rows:4,className:"w-full border border-gray-300 rounded p-2 bg-white",value:i?.description||"",onChange:e=>o(a=>({...a,description:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"sector",children:"Sector"}),(0,t.jsxs)("select",{id:"sector",name:"sector",value:i?.sectorId||0,onChange:e=>o(a=>({...a,sectorId:Number(e.target.value)})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,t.jsx)("option",{value:0,children:"Seleccionar sector"}),R.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"institution",children:"Instituci\xF3n"}),(0,t.jsxs)("select",{id:"institution",name:"institution",value:i?.institutionId||0,onChange:e=>o(a=>({...a,institutionId:Number(e.target.value)})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,t.jsx)("option",{value:0,children:"Seleccionar instituci\xF3n"}),J.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"opportunityType",children:"Tipo de Oportunidad"}),(0,t.jsxs)("select",{id:"opportunityType",name:"opportunityType",value:i?.opportunityTypeId||0,onChange:e=>o(a=>({...a,opportunityTypeId:Number(e.target.value)})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,t.jsx)("option",{value:0,children:"Seleccionar tipo"}),K.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"locality",children:"Localidad"}),(0,t.jsxs)("select",{id:"locality",name:"locality",value:i?.localityId||0,onChange:e=>o(a=>({...a,localityId:Number(e.target.value)})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,t.jsx)("option",{value:0,children:"Seleccionar localidad"}),W.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"modality",children:"Modalidad"}),(0,t.jsx)(c,{id:"modality",name:"modality",value:i?.modality||"",onChange:e=>o(a=>({...a,modality:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"status",children:"Estado"}),(0,t.jsxs)("select",{id:"status",name:"status",value:i?.status||"abierta",onChange:e=>o(a=>({...a,status:e.target.value})),className:"w-full border border-gray-300 rounded p-2 bg-white",children:[(0,t.jsx)("option",{value:"abierta",children:"Abierta"}),(0,t.jsx)("option",{value:"cerrada",children:"Cerrada"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"expirationDate",children:"Fecha de expiraci\xF3n"}),(0,t.jsx)(c,{id:"expirationDate",name:"expirationDate",type:"date",value:i?.expirationDate?.split("T")[0]||"",onChange:e=>o(a=>({...a,expirationDate:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"requirements",children:"Requisitos"}),(0,t.jsx)(c,{id:"requirements",name:"requirements",value:i?.requirements||"",onChange:e=>o(a=>({...a,requirements:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r,{htmlFor:"benefits",children:"Beneficios"}),(0,t.jsx)(c,{id:"benefits",name:"benefits",value:i?.benefits||"",onChange:e=>o(a=>({...a,benefits:e.target.value}))})]})]}),(0,t.jsxs)(w,{children:[(0,t.jsx)(s,{variant:"outline",onClick:()=>o(null),children:"Cancelar"}),(0,t.jsx)(s,{onClick:_,children:"Guardar"})]})]})}),(0,t.jsx)(b,{open:!!y,onOpenChange:()=>u(null),children:(0,t.jsxs)(f,{"aria-describedby":"delete-opportunity-description",children:[(0,t.jsxs)(N,{children:[(0,t.jsx)(D,{children:"\xBFEliminar oportunidad?"}),(0,t.jsx)(F,{id:"delete-opportunity-description",children:"Esta acci\xF3n es irreversible. \xBFDeseas continuar?"})]}),(0,t.jsxs)(w,{children:[(0,t.jsx)(s,{onClick:()=>u(null),variant:"outline",children:"Cancelar"}),(0,t.jsx)(s,{onClick:Z,variant:"destructive",children:"Eliminar"})]})]})})]})}export{B as default};
