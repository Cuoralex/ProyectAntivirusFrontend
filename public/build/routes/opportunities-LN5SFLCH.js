import{a as D,b as T,c as k}from"/build/_shared/chunk-CLFFPRWY.js";import{a as B}from"/build/_shared/chunk-5VJRENMX.js";import{a as E}from"/build/_shared/chunk-4AULA3DX.js";import"/build/_shared/chunk-AMZSOOKO.js";import{o as O}from"/build/_shared/chunk-LU4WXESO.js";import{h as P,p as F}from"/build/_shared/chunk-UIQJLUVK.js";import{a as C,b as x}from"/build/_shared/chunk-F33EF4G7.js";import{d as p}from"/build/_shared/chunk-2QEWK57A.js";var q=p(B(),1),S=p(C(),1);var I=p(C(),1);var w=p(C(),1);var N=p(x(),1),U=({opportunityId:o,comment:r,userId:f,isWhiteText:i=!1})=>{let[m,y]=(0,w.useState)(0),[g,v]=(0,w.useState)(0),[s,l]=(0,w.useState)(0),[c,n]=(0,w.useState)(!1);(0,w.useEffect)(()=>{fetch(`http://localhost:5055/api/v1/ratings/opportunity/${o}/average`).then(a=>{if(!a.ok)throw new Error(`Error en la API: ${a.status} - ${a.statusText}`);return a.json()}).then(a=>{l(a.Average||0)}).catch(a=>console.error("Error al obtener la calificaci\xF3n:",a))},[o]);let b=a=>{if(m>0)return;let h={opportunityId:o,score:a,userId:f,comment:r||"Sin comentario"};fetch(`http://localhost:5055/api/v1/ratings/opportunity/${o}/average`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(async d=>{if(!d.ok){let M=await d.text();console.error("Error en la respuesta del backend:",M);return}return d.json()}).then(d=>{d&&(console.log("Nuevo promedio guardado:",d.average),y(a),l(d.average),n(!0))}).catch(d=>console.error("Error al enviar la calificaci\xF3n:",d))};return(0,N.jsxs)("div",{className:"flex items-center text-sm mt-2",children:[[...Array(5)].map((a,h)=>(0,N.jsx)(O,{size:20,fill:h<(g||m)?"#ffcc00":"transparent",stroke:"#ffcc00",className:"cursor-pointer",onMouseEnter:()=>!c&&v(h+1),onMouseLeave:()=>!c&&v(0),onClick:()=>b(h+1)},h)),(0,N.jsxs)("span",{className:`ml-2 ${i?"text-white":"text-gray-700 ml-2"}`,children:["(",(g||m||s).toFixed(1),"/5)"]})]})},$=U;var e=p(x(),1),z=({opportunity:o})=>{let r=o.price??0,f=o.discountPrice??r,[i,m]=(0,I.useState)(!1),[y,g]=(0,I.useState)(!1),v=l=>new Date(l).toISOString().split("T")[0],s=async()=>{try{(await fetch(`http://localhost:5055/api/v1/favorites/${o.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunityId:o.id})})).ok&&g(!0)}catch(l){console.error("Error al marcar como favorita:",l)}};return(0,I.useEffect)(()=>{(async()=>{try{let c=await fetch("http://localhost:5055/api/v1/favorites");if(!c.ok)throw new Error(`Error en la API: ${c.status} - ${c.statusText}`);let n=await c.json().catch(()=>(console.warn("La respuesta de favoritos no es JSON v\xE1lido"),[]));g(n.some(b=>b.opportunityId===o.id))}catch(c){console.error("Error al obtener favoritos:",c)}})()},[o.id]),(0,e.jsx)("div",{className:"mx-auto flex flex-wrap justify-center items-start gap-8 p-4",children:(0,e.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-w-sm w-72 h-96 border border-gray-200",children:i?(0,e.jsxs)("div",{className:"h-full flex flex-col justify-between p-4 bg-yellow-400 text-gray-900",children:[(0,e.jsx)("h2",{className:"text-lg font-semibold",children:o.title}),(0,e.jsx)("p",{className:"text-sm",children:o.description}),(0,e.jsxs)("div",{className:"text-xs mt-2",children:[(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Categor\xEDa:"})," ",o.categoryName]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Beneficios:"})," ",o.benefits]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Modalidad:"})," ",o.modality]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Fecha de Expiraci\xF3n:"})," ",v(o.expiration)]})]}),(0,e.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,e.jsx)("button",{className:"flex-1 bg-blue-600 text-white text-sm font-bold py-2 rounded-lg hover:bg-blue-700 transition",onClick:()=>m(!1),children:"Volver"}),(0,e.jsx)("button",{className:"flex-1 bg-gray-800 text-white text-sm font-bold py-2 rounded-lg hover:bg-gray-900 transition",onClick:()=>window.open(`/instituciones/${o.institutionId}`,"_blank"),children:"Postularme"})]})]}):(0,e.jsxs)("div",{className:`h-full flex flex-col justify-between p-4 ${[2,8,9].includes(o.institutionId)?"bg-[#3C3C3C] text-white":"bg-white"}`,children:[(0,e.jsxs)("div",{className:"relative w-full h-32 overflow-hidden",children:[(0,e.jsx)("img",{src:`/images/institutions/${o.institutionId}.png`,alt:`Logo de ${o.institutionId}`,className:"w-full h-full object-contain"}),(0,e.jsx)("span",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded",children:o.status})]}),(0,e.jsxs)("div",{className:"flex flex-col flex-grow justify-between",children:[(0,e.jsx)("h2",{className:`text-lg font-semibold ${[2,8,9].includes(o.institutionId)?"text-white":"text-gray-900"}`,children:o.title}),(0,e.jsxs)("div",{className:`text-xs mt-2 ${[2,8,9].includes(o.institutionId)?"text-white":"text-gray-500"}`,children:[(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Instituci\xF3n:"})," ",o.institutionId]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Sector:"})," ",o.sectorName]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Tipo de Oportunidad:"})," ",o.opportunityTypeName]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Ubicaci\xF3n:"})," ",o.localityCity]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Fecha de Publicaci\xF3n:"})," ",v(o.publicationDate)]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:"Fecha de Expiraci\xF3n:"})," ",v(o.expiration)]})]})]}),(0,e.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsxs)("span",{className:"text-green-600 font-bold text-lg",children:["$",f.toFixed(2)]}),f<r&&(0,e.jsxs)("span",{className:`line-through text-sm ${[2,8,9].includes(o.institutionId)?"text-white":"text-gray-500"}`,children:["$",r.toFixed(2)]})]}),(0,e.jsx)("div",{className:[2,8,9].includes(o.institutionId)?"text-white":"text-gray-500",children:(0,e.jsx)($,{opportunityId:o.id,userId:o.userId,comment:o.comment,score:o.score,isWhiteText:[2,8,9].includes(o.institutionId)})})]}),(0,e.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,e.jsx)("button",{className:`flex-1 text-sm font-bold py-2 rounded-lg transition ${y?"bg-gray-500 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,onClick:s,disabled:y,children:y?"Marcada como Favorita":"Marcar Favorita"}),(0,e.jsx)("button",{className:`flex-1 text-sm font-bold py-2 rounded-lg hover:bg-gray-300 transition ${[2,8,9].includes(o.institutionId)?"bg-gray-600 text-white":"bg-gray-200 text-gray-700"}`,onClick:()=>m(!0),children:"M\xE1s informaci\xF3n"})]})]})})})},A=z;var R=p(C(),1),t=p(x(),1),J=({onFilterChange:o})=>{let[r,f]=(0,R.useState)({}),i=g=>{let{name:v,value:s}=g.target;console.log(`Nombre: ${v}, Valor: ${s}`),f(l=>({...l,[v]:s?isNaN(Number(s))?s:Number(s):void 0}))},m={title:"",opportunityTypeId:0,localityId:0,institutionId:0,sectorId:0,status:"",publicationDate:"",expirationDate:"",price:void 0},y=()=>{f(m),o(m)};return(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-center text-3xl font-bold text-white bg-gray-300 py-2",children:"Filtro Oportunidades"}),(0,t.jsx)("div",{className:"bg-white p-4 rounded shadow-md h-full sticky top-0",children:(0,t.jsxs)("form",{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"keyword",className:"block text-gray-700 font-medium",children:"Palabra clave"}),(0,t.jsx)("input",{type:"text",name:"title",value:r.title??"",placeholder:"Buscar t\xEDtulo",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"Opportunity_types",className:"block text-gray-700 font-medium",children:"Tipo de Oportunidad"}),(0,t.jsxs)("select",{name:"opportunityTypeId",value:r.opportunityTypeId??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full",children:[(0,t.jsx)("option",{value:"",children:"Tipo de oportunidad"}),(0,t.jsx)("option",{value:"1",children:"Educaci\xF3n Superior"}),(0,t.jsx)("option",{value:"2",children:"Becas y Ayudas Financieras"}),(0,t.jsx)("option",{value:"3",children:"Empleabilidad y Pr\xE1cticas"}),(0,t.jsx)("option",{value:"4",children:"Emprendimiento e Innovaci\xF3n"}),(0,t.jsx)("option",{value:"5",children:"Capacitaci\xF3n y Desarrollo Profesional"}),(0,t.jsx)("option",{value:"6",children:"Bienestar y Apoyo Estudiantil"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"institutions",className:"block text-gray-700 font-medium",children:"Instituciones"}),(0,t.jsxs)("select",{name:"institutionId",value:r.institutionId??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full",children:[(0,t.jsx)("option",{value:"",children:"Instituciones"}),(0,t.jsx)("option",{value:"1",children:"Universidad de Antioquia"}),(0,t.jsx)("option",{value:"2",children:"Universidad Nacional (Sede Medell\xEDn)"}),(0,t.jsx)("option",{value:"3",children:"Universidad de Medell\xEDn"}),(0,t.jsx)("option",{value:"4",children:"Universidad EAFIT"}),(0,t.jsx)("option",{value:"5",children:"Universidad Pontificia Bolivariana"}),(0,t.jsx)("option",{value:"6",children:"Instituci\xF3n Universitaria Pascual Bravo"}),(0,t.jsx)("option",{value:"7",children:"Tecnol\xF3gico de Antioquia"}),(0,t.jsx)("option",{value:"8",children:"Instituci\xF3n Universitaria ITM"}),(0,t.jsx)("option",{value:"9",children:"Polit\xE9cnico Jaime Isaza Cadavid"}),(0,t.jsx)("option",{value:"10",children:"Servicio Nacional de Aprendizaje (SENA)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"sectors",className:"block text-gray-700 font-medium",children:"Sectores"}),(0,t.jsxs)("select",{name:"sectorId",value:r.sectorId??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full",children:[(0,t.jsx)("option",{value:"",children:"Sectores"}),(0,t.jsx)("option",{value:"1",children:"Administrativo"}),(0,t.jsx)("option",{value:"2",children:"Energ\xEDa"}),(0,t.jsx)("option",{value:"3",children:"Social"}),(0,t.jsx)("option",{value:"4",children:"Agropecuario"}),(0,t.jsx)("option",{value:"5",children:"Formaci\xF3n"}),(0,t.jsx)("option",{value:"6",children:"Transporte"}),(0,t.jsx)("option",{value:"7",children:"Alimentos"}),(0,t.jsx)("option",{value:"8",children:"Industria"}),(0,t.jsx)("option",{value:"9",children:"Tecnolog\xEDa"}),(0,t.jsx)("option",{value:"10",children:"Turismo"}),(0,t.jsx)("option",{value:"11",children:"Comercio"}),(0,t.jsx)("option",{value:"12",children:"Moda y Belleza"}),(0,t.jsx)("option",{value:"13",children:"Salud"}),(0,t.jsx)("option",{value:"14",children:"Construcci\xF3n"}),(0,t.jsx)("option",{value:"15",children:"Servicio al Cliente"}),(0,t.jsx)("option",{value:"16",children:"Sustentabilidad"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"localities",className:"block text-gray-700 font-medium",children:"Ubicaci\xF3n"}),(0,t.jsxs)("select",{name:"localityId",value:r.localityId??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full",children:[(0,t.jsx)("option",{value:"",children:"Ubicaci\xF3n"}),(0,t.jsx)("option",{value:"1",children:"Medell\xEDn"}),(0,t.jsx)("option",{value:"2",children:"Bello"}),(0,t.jsx)("option",{value:"3",children:"Envigado"}),(0,t.jsx)("option",{value:"4",children:"Itag\xFC\xED"}),(0,t.jsx)("option",{value:"5",children:"Bogot\xE1"}),(0,t.jsx)("option",{value:"6",children:"Cali"}),(0,t.jsx)("option",{value:"7",children:"Barranquilla"}),(0,t.jsx)("option",{value:"8",children:"Cartagena"}),(0,t.jsx)("option",{value:"9",children:"Bucaramanga"}),(0,t.jsx)("option",{value:"10",children:"Pereira"}),(0,t.jsx)("option",{value:"11",children:"Armenia"}),(0,t.jsx)("option",{value:"12",children:"Manizales"}),(0,t.jsx)("option",{value:"13",children:"Ibagu\xE9"}),(0,t.jsx)("option",{value:"14",children:"Pasto"}),(0,t.jsx)("option",{value:"15",children:"Neiva"}),(0,t.jsx)("option",{value:"16",children:"Villavicencio"}),(0,t.jsx)("option",{value:"17",children:"C\xFAcuta"}),(0,t.jsx)("option",{value:"18",children:"Valledupar"}),(0,t.jsx)("option",{value:"19",children:"Santa Marta"}),(0,t.jsx)("option",{value:"20",children:"Tunja"}),(0,t.jsx)("option",{value:"21",children:"Sincelejo"}),(0,t.jsx)("option",{value:"22",children:"Monter\xEDa"}),(0,t.jsx)("option",{value:"23",children:"Popay\xE1n"}),(0,t.jsx)("option",{value:"24",children:"Yopal"}),(0,t.jsx)("option",{value:"25",children:"San Jos\xE9 del Guaviare"}),(0,t.jsx)("option",{value:"26",children:"Leticia"}),(0,t.jsx)("option",{value:"27",children:"Quibd\xF3"}),(0,t.jsx)("option",{value:"28",children:"Arauca"}),(0,t.jsx)("option",{value:"29",children:"In\xEDrida"}),(0,t.jsx)("option",{value:"30",children:"Mit\xFA"}),(0,t.jsx)("option",{value:"31",children:"Puerto Carre\xF1o"}),(0,t.jsx)("option",{value:"32",children:"San Andr\xE9s"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"publicationDate",className:"block text-gray-700 font-medium",children:"Fecha de apertura"}),(0,t.jsx)("input",{type:"date",name:"publicationDate",value:r.publicationDate??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full appearance-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"expirationDate",className:"block text-gray-700 font-medium",children:"Fecha de cierre"}),(0,t.jsx)("input",{type:"date",name:"expirationDate",value:r.expirationDate??"",onChange:i,className:"bg-gray-200 text-gray-700 p-2 rounded-md w-full appearance-none"})]}),(0,t.jsxs)("div",{className:"flex justify-end mt-4",children:[(0,t.jsx)("button",{type:"button",className:"mr-4 bg-gray-600 text-white px-4 py-2 rounded",onClick:y,children:"Restablecer"}),(0,t.jsx)("button",{type:"button",className:"bg-indigo-600 text-white px-4 py-2 rounded",onClick:()=>o(r),children:"Aplicar"})]})]})})]})},L=J;var u=p(x(),1);function j(){let{opportunities:o}=F(),[r,f]=P(),[i,m]=(0,S.useState)({title:"",opportunityTypeId:0,localityId:0,institutionId:0,sectorId:0,status:"",publicationDate:"",expirationDate:"",price:void 0}),y=n=>{m(b=>({...b,...n}))},[g,v]=(0,S.useState)(Number(r.get("page"))||1),s=10,l=o.filter(n=>{let b=i.expirationDate?new Date(i.expirationDate):null,a=i.publicationDate?new Date(i.publicationDate):null,h=n.expirationDate?new Date(n.expirationDate):null,d=n.publicationDate?new Date(n.publicationDate):null;return(!i.title||n.title.toLowerCase().includes(i.title.toLowerCase()))&&(!i.opportunityTypeId||n.opportunityTypeId===Number(i.opportunityTypeId))&&(!i.localityId||n.localityId===Number(i.localityId))&&(!i.institutionId||n.institutionId===Number(i.institutionId))&&(!i.sectorId||n.sectorId===Number(i.sectorId))&&(!i.status||n.status===i.status)&&(!b||h&&h.toISOString().split("T")[0]===b.toISOString().split("T")[0])&&(!a||d&&d.toISOString().split("T")[0]===a.toISOString().split("T")[0])&&(!i.price||n.price<=i.price)}),c=l.slice((g-1)*s,g*s);return(0,u.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-100 pb-20",children:[(0,u.jsxs)("div",{className:"flex-grow flex flex-col md:flex-row p-6 gap-4",children:[(0,u.jsx)("div",{className:"w-full md:w-1/4 p-4 bg-white shadow-lg rounded-xl md:sticky md:top-4 md:self-start md:h-[calc(100vh-2rem)] overflow-y-auto",children:(0,u.jsx)(L,{onFilterChange:y})}),(0,u.jsx)("div",{className:"w-full md:w-3/4 p-4 grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-4 justify-center",children:c.length>0?c.map(n=>(0,u.jsx)(A,{opportunity:n},n.id)):(0,u.jsx)("p",{className:"text-gray-600",children:"No se encontraron oportunidades."})})]}),(0,u.jsx)(E,{currentPage:g,totalItems:l.length,pageSize:s,onPageChange:n=>{v(n),f(b=>{let a=new URLSearchParams(b);return a.set("page",String(n)),a})}}),(0,u.jsx)(k,{}),(0,u.jsx)(D,{}),(0,u.jsx)(T,{})]})}export{j as default};
