import{a as b,b as N,c as S,d as D,e as C,f as I,g as w,h as y}from"/build/_shared/chunk-4TU7APBU.js";import{c as n}from"/build/_shared/chunk-MGHLVMKF.js";import{a as O}from"/build/_shared/chunk-LV3DFGJF.js";import"/build/_shared/chunk-AMZSOOKO.js";import"/build/_shared/chunk-NKGL3J4W.js";import{l as L,m as F,q as j}from"/build/_shared/chunk-LU4WXESO.js";import{h as T}from"/build/_shared/chunk-GSPLIXRC.js";import{a as M,b as B}from"/build/_shared/chunk-F33EF4G7.js";import{d as v}from"/build/_shared/chunk-2QEWK57A.js";var r=v(M(),1);var e=v(B(),1);function H(){let[A,p]=(0,r.useState)([]),[a,i]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[x,U]=(0,r.useState)(""),[d,$]=T(),[g,P]=(0,r.useState)(Number(d.get("page"))||1),[h,G]=(0,r.useState)(Number(d.get("pageSize"))||10),[J,k]=(0,r.useState)(!0),E=async()=>{k(!0);try{let o=await(await fetch("http://localhost:5055/api/v1/sectors",{credentials:"include"})).json();p(o)}catch(t){console.error("Error al cargar sectores",t)}finally{k(!1)}},R=async()=>{if(!a)return;let t=a.id?"PUT":"POST",o=a.id?`http://localhost:5055/api/v1/sectors/${a.id}`:"http://localhost:5055/api/v1/sectors",m=JSON.stringify({name:a.name,description:a.description});try{let s=await fetch(o,{method:t,headers:{"Content-Type":"application/json"},credentials:"include",body:m});if(s.ok){if(a.id)p(f=>f.map(l=>l.id===a.id?{...l,name:a.name,description:a.description}:l));else{let f=await s.json();p(l=>[...l,f]),P(1)}i(null)}else console.error("Error al guardar sector",await s.json())}catch(s){console.error("Error en la petici\xF3n",s)}},q=async()=>{if(u)try{await fetch(`http://localhost:5055/api/v1/sectors/${u}`,{method:"DELETE",credentials:"include"}),c(null),E()}catch(t){console.error("Error al eliminar sector",t)}};(0,r.useEffect)(()=>{E()},[]);let z=A.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())),K=z.slice((g-1)*h,g*h);return(0,r.useEffect)(()=>{let t=Number(d.get("pageSize"))||10;G(t)},[d]),(0,e.jsxs)("div",{children:[J?(0,e.jsx)("p",{className:"text-4xl",children:"Cargando sectores..."}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)(n,{onClick:()=>i({name:"",description:""}),className:"flex gap-2 items-center",children:[(0,e.jsx)(F,{size:18})," Nuevo"]}),(0,e.jsx)(b,{placeholder:"Buscar por nombre...",value:x,onChange:t=>U(t.target.value),className:"w-1/2"})]}),(0,e.jsx)("div",{className:"overflow-auto",children:(0,e.jsxs)("table",{className:"min-w-full bg-white rounded shadow dark:bg-neutral-600",children:[(0,e.jsx)("thead",{className:"bg-gray-100",children:(0,e.jsxs)("tr",{className:"dark:text-black",children:[(0,e.jsx)("th",{className:"p-2 text-left",children:"Nombre"}),(0,e.jsx)("th",{className:"p-2 text-left",children:"Descripci\xF3n"}),(0,e.jsx)("th",{className:"p-2 text-left",children:"Acciones"})]})}),(0,e.jsx)("tbody",{children:K.map(t=>(0,e.jsxs)("tr",{className:"border-t",children:[(0,e.jsx)("td",{className:"p-2 text-left",children:t.name}),(0,e.jsx)("td",{className:"p-2 text-left",children:t.description?.length?t.description:"Sin descripci\xF3n"}),(0,e.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,e.jsx)(n,{variant:"outline",size:"sm",onClick:()=>i(t),children:(0,e.jsx)(L,{size:16})}),(0,e.jsx)(n,{variant:"destructive",size:"sm",onClick:()=>c(t.id),children:(0,e.jsx)(j,{size:16})})]})]},t.id))})]})})]}),(0,e.jsx)(O,{currentPage:g,totalItems:z.length,pageSize:h,onPageChange:t=>{P(t),$(o=>{let m=new URLSearchParams(o);return m.set("page",String(t)),m})}}),(0,e.jsx)(N,{open:!!a,onOpenChange:()=>i(null),children:(0,e.jsxs)(S,{className:"max-w-md",children:[(0,e.jsx)(D,{children:(0,e.jsx)(C,{children:a?.id?"Editar Sector":"Nuevo Sector"})}),(0,e.jsxs)("form",{className:"space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(y,{htmlFor:"name",children:"Nombre"}),(0,e.jsx)(b,{id:"name",value:a?.name||"",onChange:t=>i(o=>({...o,name:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(y,{htmlFor:"description",children:"Descripci\xF3n"}),(0,e.jsx)("textarea",{id:"description",rows:3,className:"w-full border border-gray-300 rounded p-2 bg-white",value:a?.description||"",onChange:t=>i(o=>({...o,description:t.target.value}))})]})]}),(0,e.jsxs)(w,{children:[(0,e.jsx)(n,{variant:"outline",onClick:()=>i(null),children:"Cancelar"}),(0,e.jsx)(n,{onClick:R,children:"Guardar"})]})]})}),(0,e.jsx)(N,{open:!!u,onOpenChange:()=>c(null),children:(0,e.jsxs)(S,{"aria-describedby":"delete-sector-description",children:[(0,e.jsxs)(D,{children:[(0,e.jsx)(C,{children:"\xBFEliminar sector?"}),(0,e.jsx)(I,{id:"delete-sector-description",children:"Esta acci\xF3n es irreversible. \xBFDeseas continuar?"})]}),(0,e.jsxs)(w,{children:[(0,e.jsx)(n,{onClick:()=>c(null),variant:"outline",children:"Cancelar"}),(0,e.jsx)(n,{onClick:q,variant:"destructive",children:"Eliminar"})]})]})})]})}export{H as default};
