import{a as $}from"/build/_shared/chunk-LXQEBCO3.js";import{a as n,b as w,c as D,d as U,e as E,f as S,g as L,h as c}from"/build/_shared/chunk-JB55QAS3.js";import{c as s}from"/build/_shared/chunk-MGHLVMKF.js";import{a as H}from"/build/_shared/chunk-2MFZW4W2.js";import"/build/_shared/chunk-AMZSOOKO.js";import"/build/_shared/chunk-NKGL3J4W.js";import{l as z,q as B}from"/build/_shared/chunk-LU4WXESO.js";import{h as A,o as k}from"/build/_shared/chunk-2IM6IZL7.js";import{a as K,b as x}from"/build/_shared/chunk-F33EF4G7.js";import{d as y}from"/build/_shared/chunk-2QEWK57A.js";var r=y(K(),1);var e=y(x(),1);function Q(){return k().find(d=>d.id==="root")?.data?.email??null}function F(){let[p,g]=(0,r.useState)([]),[T,d]=(0,r.useState)(!0),[i,o]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),f=Q(),[u,I]=A(),[P,O]=(0,r.useState)(""),[v,R]=(0,r.useState)(Number(u.get("page"))||1),[b,j]=(0,r.useState)(Number(u.get("pageSize"))||14);(0,r.useEffect)(()=>{let t=Number(u.get("pageSize"))||14;j(t)},[u]);let N=async()=>{d(!0);try{let a=await(await fetch("http://localhost:5055/api/v1/user",{credentials:"include"})).json();g(a)}catch(t){console.error("Error al cargar usuarios",t)}finally{d(!1)}},J=async(t,a)=>{try{await fetch(`http://localhost:5055/api/v1/user/${t}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isActive:!a})}),g(l=>l.map(C=>C.id===t?{...C,isActive:!a}:C))}catch(l){console.error("Error al cambiar estado",l)}},M=async()=>{if(h)try{await fetch(`http://localhost:5055/api/v1/user/${h}`,{method:"DELETE",credentials:"include"}),m(null),N()}catch(t){console.error("Error al eliminar usuario",t)}},q=async()=>{if(i)try{await fetch(`http://localhost:5055/api/v1/user/${i.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)}),o(null),N()}catch(t){console.error("Error al editar usuario",t)}};(0,r.useEffect)(()=>{N()},[]);let G=[...p].sort((t,a)=>t.email===f?-1:a.email===f?1:0).filter(t=>{let a=P.toLowerCase();return t.fullName.toLowerCase().includes(a)||t.email.toLowerCase().includes(a)||t.role.toLowerCase().includes(a)||t.phone?.toLowerCase().includes(a)||t.birthdate?.toLowerCase().includes(a)}).slice((v-1)*b,v*b);return(0,e.jsxs)("div",{children:[T?(0,e.jsx)("p",{className:"text-4xl",children:"Cargando usuarios..."}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mb-2",children:(0,e.jsx)(n,{placeholder:"Buscar usuario por cualquier campo...",value:P,onChange:t=>O(t.target.value),className:"w-full md:w-1/2"})}),(0,e.jsx)("div",{className:"overflow-auto",children:(0,e.jsxs)("table",{className:"min-w-full bg-white dark:bg-neutral-600  shadow-md rounded-md",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{className:"bg-gray-100 text-left dark:text-black",children:[(0,e.jsx)("th",{className:"p-2",children:"Nombre"}),(0,e.jsx)("th",{className:"p-2",children:"Email"}),(0,e.jsx)("th",{className:"p-2",children:"Tel\xE9fono"}),(0,e.jsx)("th",{className:"p-2",children:"Rol"}),(0,e.jsx)("th",{className:"p-2",children:"Nacimiento"}),(0,e.jsx)("th",{className:"p-2",children:"Activo"}),(0,e.jsx)("th",{className:"p-2",children:"Acciones"})]})}),(0,e.jsx)("tbody",{children:G.map(t=>{let a=t.email===f;return(0,e.jsxs)("tr",{className:"border-t",children:[(0,e.jsx)("td",{className:"p-2",children:t.fullName}),(0,e.jsx)("td",{className:"p-2",children:t.email}),(0,e.jsx)("td",{className:"p-2",children:t.phone??"-"}),(0,e.jsx)("td",{className:"p-2",children:t.role}),(0,e.jsx)("td",{className:"p-2",children:t.birthdate?.split("T")[0]??""}),(0,e.jsx)("td",{className:"p-2",children:!a&&(0,e.jsx)($,{checked:t.isActive,onChange:()=>J(t.id,t.isActive),className:`${t.isActive?"bg-green-500":"bg-gray-300"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors`,children:(0,e.jsx)("span",{className:`${t.isActive?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})}),(0,e.jsxs)("td",{className:"p-2 flex gap-2",children:[(0,e.jsx)(s,{size:"sm",variant:"outline",onClick:()=>o(t),children:(0,e.jsx)(z,{size:16})}),!a&&(0,e.jsx)(s,{size:"sm",variant:"destructive",onClick:()=>m(t.id),children:(0,e.jsx)(B,{size:16})})]})]},t.id)})})]})}),(0,e.jsx)(H,{currentPage:v,totalItems:p.length,pageSize:b,onPageChange:t=>{R(t),I(a=>{let l=new URLSearchParams(a);return l.set("page",String(t)),l})}})]}),(0,e.jsx)(w,{open:!!i,onOpenChange:()=>o(null),children:(0,e.jsxs)(D,{"aria-describedby":"edit-user-description",children:[(0,e.jsxs)(U,{children:[(0,e.jsx)(E,{children:"Editar Usuario"}),(0,e.jsx)(S,{id:"edit-user-description",children:"Modifica los campos y guarda los cambios para este usuario."})]}),i&&(0,e.jsxs)("form",{className:"space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(c,{children:"Nombre completo"}),(0,e.jsx)(n,{value:i.fullName,onChange:t=>o(a=>({...a,fullName:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(c,{children:"Email"}),(0,e.jsx)(n,{type:"email",value:i.email,onChange:t=>o(a=>({...a,email:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(c,{children:"Tel\xE9fono"}),(0,e.jsx)(n,{value:i.phone??"",onChange:t=>o(a=>({...a,phone:t.target.value}))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(c,{children:"Rol"}),(0,e.jsxs)("select",{className:"w-full border border-gray-300 rounded px-2 py-1 bg-white",value:i.role,onChange:t=>o(a=>({...a,role:t.target.value})),children:[(0,e.jsx)("option",{value:"admin",children:"Administrador"}),(0,e.jsx)("option",{value:"user",children:"Estudiante"})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(c,{children:"Fecha de nacimiento"}),(0,e.jsx)(n,{type:"date",value:i.birthdate?.split("T")[0]??"",onChange:t=>o(a=>({...a,birthdate:t.target.value}))})]})]}),(0,e.jsxs)(L,{children:[(0,e.jsx)(s,{onClick:()=>o(null),variant:"outline",children:"Cancelar"}),(0,e.jsx)(s,{onClick:q,children:"Guardar"})]})]})}),(0,e.jsx)(w,{open:!!h,onOpenChange:()=>m(null),children:(0,e.jsxs)(D,{"aria-describedby":"delete-user-description",children:[(0,e.jsxs)(U,{children:[(0,e.jsx)(E,{children:"\xBFEliminar usuario?"}),(0,e.jsx)(S,{id:"delete-user-description",children:"Esta acci\xF3n es irreversible. \xBFDeseas continuar?"})]}),(0,e.jsxs)(L,{children:[(0,e.jsx)(s,{onClick:()=>m(null),variant:"outline",children:"Cancelar"}),(0,e.jsx)(s,{onClick:M,variant:"destructive",children:"Eliminar"})]})]})})]})}export{F as default};
